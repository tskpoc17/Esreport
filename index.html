<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>寧靜車廂勸導紀錄</title>
    <style>
        :root { --primary: #2c3e50; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 5px; font-size: 14px; }
        
        .header { background: var(--primary); color: white; padding: 8px; border-radius: 5px; text-align: center; margin-bottom: 5px; }
        .station-in { background: transparent; border: none; border-bottom: 1px solid white; color: white; width: 60px; text-align: center; font-size: 16px; }
        
        .summary { background: white; padding: 8px; border-radius: 5px; display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 5px; border-left: 4px solid #e74c3c; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        .card { background: white; border-radius: 5px; margin-bottom: 5px; padding: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-title { font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 3px; margin-bottom: 5px; display: flex; justify-content: space-between; font-size: 13px; }
        
        .row { display: flex; gap: 3px; margin-bottom: 3px; align-items: center; }
        .idx { width: 15px; font-size: 11px; color: #999; text-align: right; }
        .input-box { flex: 1; display: flex; border: 1px solid #ccc; border-radius: 3px; overflow: hidden; height: 26px; }
        .input-box label { background: #f8f9fa; padding: 0 4px; line-height: 26px; font-size: 11px; color: #666; border-right: 1px solid #eee; white-space: nowrap; }
        .input-box input { border: none; width: 100%; padding: 0 5px; font-size: 14px; outline: none; }

        .action-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 8px; display: flex; gap: 5px; border-top: 1px solid #ddd; }
        .btn { flex: 1; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-shot { background: var(--primary); color: white; }
        .btn-clr { background: #bdc3c7; color: white; }

        /* 截圖模式 */
        body.screenshot-mode { background: white; padding: 10px; }
        body.screenshot-mode .action-bar, 
        body.screenshot-mode .empty-row { display: none !important; }
        body.screenshot-mode .card { box-shadow: none; border: 1px solid #eee; }
        
        #timeLabel { display: none; font-size: 12px; margin-top: 5px; opacity: 0.8; }
        body.screenshot-mode #timeLabel { display: block; }
        .spacer { height: 60px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight: bold;">北 <input type="text" id="station" class="station-in" placeholder="____"> 車下</div>
        <div id="timeLabel"></div>
    </div>

    <div class="summary">
        <span>勸導總件數：</span>
        <span><span id="grandTotal">0</span> 件</span>
    </div>

    <div class="card">
        <div class="card-title">A. 大聲喧嘩 <span id="count-a">0</span> 件</div>
        <div id="grid-a"></div>
    </div>

    <div class="card">
        <div class="card-title">B. 講電話 <span id="count-b">0</span> 件</div>
        <div id="grid-b"></div>
    </div>

    <div class="card">
        <div class="card-title">C. 3C產品 <span id="count-c">0</span> 件</div>
        <div id="grid-c"></div>
    </div>

    <div class="spacer"></div>

    <div class="action-bar">
        <button class="btn btn-clr" onclick="resetForm()">清除</button>
        <button class="btn btn-shot" onclick="toggleMode()">截圖模式</button>
    </div>

<script>
    const configs = [
        { id: 'grid-a', prefix: 'a' },
        { id: 'grid-b', prefix: 'b' },
        { id: 'grid-c', prefix: 'c' }
    ];

    function init() {
        configs.forEach(conf => {
            addSlot(conf.prefix, 1);
        });
        load();
    }

    function addSlot(prefix, num) {
        const container = document.getElementById(`grid-${prefix}`);
        if (document.getElementById(`${prefix}-row-${num}`)) return;

        const div = document.createElement('div');
        div.className = 'row empty-row';
        div.id = `${prefix}-row-${num}`;
        div.innerHTML = `
            <div class="idx">${num}</div>
            <div class="input-box">
                <label>列車</label>
                <input type="number" id="${prefix}-t-${num}" oninput="handleInput('${prefix}', ${num})">
            </div>
            <div class="input-box">
                <label>車廂</label>
                <input type="number" id="${prefix}-c-${num}" oninput="save()">
            </div>
        `;
        container.appendChild(div);
    }

    function handleInput(prefix, num) {
        const input = document.getElementById(`${prefix}-t-${num}`);
        const row = document.getElementById(`${prefix}-row-${num}`);
        
        if (input.value.trim() !== "") {
            row.classList.remove('empty-row');
            if (num < 10) addSlot(prefix, num + 1);
        } else {
            row.classList.add('empty-row');
        }
        updateTotals();
        save();
    }

    function updateTotals() {
        let grand = 0;
        configs.forEach(conf => {
            let count = 0;
            for (let i = 1; i <= 10; i++) {
                const el = document.getElementById(`${conf.prefix}-t-${i}`);
                if (el && el.value.trim() !== "") count++;
            }
            document.getElementById(`count-${conf.prefix}`).innerText = count;
            grand += count;
        });
        document.getElementById('grandTotal').innerText = grand;
    }

    function toggleMode() {
        const isMode = document.body.classList.toggle('screenshot-mode');
        if (isMode) {
            const now = new Date();
            document.getElementById('timeLabel').innerText = 
                `時間：${now.getMonth()+1}月${now.getDate()}日 ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`;
        }
    }

    function save() {
        const data = {};
        configs.forEach(c => {
            data[c.prefix] = [];
            for (let i = 1; i <= 10; i++) {
                const t = document.getElementById(`${c.prefix}-t-${i}`);
                const car = document.getElementById(`${c.prefix}-c-${i}`);
                if (t) data[c.prefix].push({ t: t.value, c: car.value });
            }
        });
        localStorage.setItem('rail_data', JSON.stringify(data));
        localStorage.setItem('rail_station', document.getElementById('station').value);
    }

    function load() {
        const saved = localStorage.getItem('rail_data');
        const sta = localStorage.getItem('rail_station');
        if (sta) document.getElementById('station').value = sta;
        if (saved) {
            const data = JSON.parse(saved);
            configs.forEach(conf => {
                data[conf.prefix].forEach((item, idx) => {
                    const num = idx + 1;
                    if (item.t || item.c) {
                        addSlot(conf.prefix, num);
                        document.getElementById(`${conf.prefix}-t-${num}`).value = item.t;
                        document.getElementById(`${conf.prefix}-c-${num}`).value = item.c;
                        if (item.t) document.getElementById(`${conf.prefix}-row-${num}`).classList.remove('empty-row');
                        if (num < 10) addSlot(conf.prefix, num + 1);
                    }
                });
            });
            updateTotals();
        }
    }

    function resetForm() {
        if (confirm('確定清除？')) {
            localStorage.clear();
            location.reload();
        }
    }

    init();
</script>
</body>
</html>

